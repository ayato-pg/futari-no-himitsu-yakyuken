<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2人の秘密、野球拳。</title>
    <link rel="stylesheet" href="./src/styles/main.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="game-container">
        <!-- ローディング画面 -->
        <div id="loading-screen" class="screen active">
            <div class="loading-content">
                <h1>2人の秘密、野球拳。</h1>
                <div class="loading-spinner"></div>
                <p>Loading...</p>
            </div>
        </div>

        <!-- タイトル画面 -->
        <div id="title-screen" class="screen">
            <div class="background" id="title-bg"></div>
            <div class="title-content">
                <div class="game-logo">
                    <h1>2人の秘密、野球拳。</h1>
                    <div class="subtitle">～大人になった二人の約束～</div>
                </div>
                
                <div class="misaki-display">
                    <img id="misaki-title" src="" alt="美咲" style="display:none;">
                </div>

                <div class="menu-buttons">
                    <button class="game-btn" id="btn-new-game">はじめから</button>
                    <button class="game-btn" id="btn-continue" disabled>つづきから</button>
                    <button class="game-btn" id="btn-gallery" disabled>ギャラリー</button>
                    <button class="game-btn" id="btn-settings">設定</button>
                </div>
            </div>
        </div>

        <!-- 会話シーン -->
        <div id="dialogue-screen" class="screen">
            <div class="background" id="dialogue-bg"></div>
            <div class="misaki-large-display">
                <img id="misaki-dialogue" src="" alt="美咲" style="display:none;">
            </div>
            <div class="dialogue-box">
                <div class="character-name">美咲</div>
                <div class="dialogue-text" id="dialogue-text"></div>
                <div class="dialogue-controls">
                    <button class="control-btn" id="btn-skip">Skip</button>
                    <button class="control-btn" id="btn-auto">Auto</button>
                    <button class="control-btn" id="btn-log">Log</button>
                    <button class="control-btn" id="btn-save">Save</button>
                    <button class="control-btn" id="btn-menu">Menu</button>
                </div>
            </div>
        </div>

        <!-- メインゲーム画面 -->
        <div id="game-screen" class="screen">
            <div class="background" id="game-bg"></div>
            
            <div class="status-top">
                <div class="round-info">ラウンド <span id="current-round">1</span>/9</div>
                <div class="win-condition">勝利条件: 5勝先取</div>
            </div>

            <div class="misaki-status">
                <div class="character-name">美咲</div>
                <div class="hp-display">
                    <div class="hp-hearts" id="misaki-hearts"></div>
                    <div class="defeat-count">敗北数: <span id="misaki-defeats">0</span></div>
                </div>
            </div>

            <div class="misaki-game-display">
                <img id="misaki-game" src="" alt="美咲" style="display:none;">
            </div>

            <div class="battle-result" id="battle-result">
                <div class="result-text" id="result-text"></div>
                <div class="hands-display">
                    <div class="hand-result">美咲: <span id="misaki-hand"></span></div>
                    <div class="vs">VS</div>
                    <div class="hand-result">あなた: <span id="player-hand"></span></div>
                </div>
            </div>

            <div class="player-status">
                <div class="character-name">あなた</div>
                <div class="hp-display">
                    <div class="hp-hearts" id="player-hearts"></div>
                    <div class="victory-count">勝利数: <span id="player-victories">0</span></div>
                </div>
            </div>

            <div class="janken-controls">
                <div class="hand-buttons">
                    <button class="hand-btn" id="btn-rock">
                        <span>グー</span>
                    </button>
                    <button class="hand-btn" id="btn-scissors">
                        <span>チョキ</span>
                    </button>
                    <button class="hand-btn" id="btn-paper">
                        <span>パー</span>
                    </button>
                </div>
                <div class="instruction">選択してください</div>
            </div>

            <div class="game-controls">
                <button class="control-btn" id="btn-special" disabled>必殺技: 未使用</button>
                <button class="control-btn" id="btn-hint">ヒント</button>
                <button class="control-btn" id="btn-surrender">降参</button>
            </div>
        </div>

        <!-- エンディング画面 -->
        <div id="ending-screen" class="screen">
            <div class="background" id="ending-bg"></div>
            <div class="ending-content">
                <div class="ending-title" id="ending-title"></div>
                <div class="ending-cg">
                    <img id="ending-image" src="" alt="エンディング" style="display:none;">
                </div>
                <div class="ending-text" id="ending-text"></div>
                <div class="ending-controls">
                    <button class="game-btn" id="btn-title-return">タイトルに戻る</button>
                    <button class="game-btn" id="btn-replay">もう一度プレイ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 統合JavaScript（インライン版） -->
    <script>
        // 簡易版ゲームコントローラー
        class SimpleGameController {
            constructor() {
                this.currentScene = 'loading';
                this.playerHP = 5;
                this.misakiHP = 5;
                this.playerWins = 0;
                this.misakiWins = 0;
                this.currentRound = 1;
                
                this.init();
            }
            
            init() {
                console.log('ゲーム初期化開始...');
                
                // 2秒後にタイトル画面へ
                setTimeout(() => {
                    this.showTitleScreen();
                }, 2000);
                
                this.setupEventListeners();
            }
            
            setupEventListeners() {
                // タイトル画面
                const newGameBtn = document.getElementById('btn-new-game');
                if (newGameBtn) {
                    newGameBtn.addEventListener('click', () => this.startNewGame());
                }
                
                // じゃんけんボタン
                document.getElementById('btn-rock')?.addEventListener('click', () => this.playJanken('rock'));
                document.getElementById('btn-scissors')?.addEventListener('click', () => this.playJanken('scissors'));
                document.getElementById('btn-paper')?.addEventListener('click', () => this.playJanken('paper'));
                
                // エンディングボタン
                document.getElementById('btn-title-return')?.addEventListener('click', () => this.showTitleScreen());
                document.getElementById('btn-replay')?.addEventListener('click', () => this.startNewGame());
            }
            
            hideAllScreens() {
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.remove('active');
                });
            }
            
            showScreen(screenId) {
                this.hideAllScreens();
                const screen = document.getElementById(screenId);
                if (screen) {
                    screen.classList.add('active');
                }
            }
            
            showTitleScreen() {
                console.log('タイトル画面表示');
                this.currentScene = 'title';
                this.showScreen('title-screen');
            }
            
            startNewGame() {
                console.log('新しいゲーム開始');
                this.resetGame();
                this.showDialogueScene();
            }
            
            resetGame() {
                this.playerHP = 5;
                this.misakiHP = 5;
                this.playerWins = 0;
                this.misakiWins = 0;
                this.currentRound = 1;
            }
            
            showDialogueScene() {
                console.log('会話シーン表示');
                this.currentScene = 'dialogue';
                this.showScreen('dialogue-screen');
                
                // 会話テキスト表示
                const dialogueText = document.getElementById('dialogue-text');
                if (dialogueText) {
                    dialogueText.textContent = '久しぶりね。今夜は二人きりだし...大人のルールで野球拳、やってみない？';
                }
                
                // 5秒後にゲーム画面へ
                setTimeout(() => {
                    this.showGameScene();
                }, 5000);
            }
            
            showGameScene() {
                console.log('ゲーム画面表示');
                this.currentScene = 'game';
                this.showScreen('game-screen');
                this.updateGameUI();
            }
            
            updateGameUI() {
                // ラウンド表示
                document.getElementById('current-round').textContent = this.currentRound;
                
                // HP表示
                this.updateHearts('misaki-hearts', this.misakiHP);
                this.updateHearts('player-hearts', this.playerHP);
                
                // 勝利数表示
                document.getElementById('misaki-defeats').textContent = this.misakiWins;
                document.getElementById('player-victories').textContent = this.playerWins;
            }
            
            updateHearts(elementId, hp) {
                const heartsContainer = document.getElementById(elementId);
                if (heartsContainer) {
                    heartsContainer.innerHTML = '';
                    for (let i = 0; i < 5; i++) {
                        const heart = document.createElement('div');
                        heart.className = i < hp ? 'heart' : 'heart empty';
                        heart.textContent = i < hp ? '♥' : '♡';
                        heart.style.display = 'inline-block';
                        heart.style.fontSize = '24px';
                        heart.style.color = i < hp ? '#ff6b7d' : '#666';
                        heart.style.marginRight = '5px';
                        heartsContainer.appendChild(heart);
                    }
                }
            }
            
            playJanken(playerHand) {
                console.log(`プレイヤーの選択: ${playerHand}`);
                
                // 美咲の手をランダムに決定
                const hands = ['rock', 'scissors', 'paper'];
                const misakiHand = hands[Math.floor(Math.random() * 3)];
                
                // 勝敗判定
                const result = this.judgeJanken(playerHand, misakiHand);
                
                // 結果表示
                this.showResult(playerHand, misakiHand, result);
                
                // HP更新
                if (result === 'win') {
                    this.misakiHP--;
                    this.playerWins++;
                } else if (result === 'lose') {
                    this.playerHP--;
                    this.misakiWins++;
                }
                
                // UI更新
                this.updateGameUI();
                
                // ゲーム終了判定
                if (this.playerWins >= 5) {
                    setTimeout(() => this.showEnding('true'), 2000);
                } else if (this.misakiWins >= 5) {
                    setTimeout(() => this.showEnding('bad'), 2000);
                } else {
                    this.currentRound++;
                    setTimeout(() => {
                        document.getElementById('battle-result').classList.remove('show');
                        this.updateGameUI();
                    }, 2000);
                }
            }
            
            judgeJanken(playerHand, misakiHand) {
                if (playerHand === misakiHand) return 'draw';
                
                const winConditions = {
                    'rock': 'scissors',
                    'scissors': 'paper',
                    'paper': 'rock'
                };
                
                return winConditions[playerHand] === misakiHand ? 'win' : 'lose';
            }
            
            showResult(playerHand, misakiHand, result) {
                const resultElement = document.getElementById('battle-result');
                const resultText = document.getElementById('result-text');
                const misakiHandText = document.getElementById('misaki-hand');
                const playerHandText = document.getElementById('player-hand');
                
                const handNames = {
                    'rock': 'グー',
                    'scissors': 'チョキ',
                    'paper': 'パー'
                };
                
                if (resultElement && resultText) {
                    resultText.textContent = result === 'win' ? 'あなたの勝ち！' : 
                                           result === 'lose' ? '美咲の勝ち！' : 'あいこ';
                    misakiHandText.textContent = handNames[misakiHand];
                    playerHandText.textContent = handNames[playerHand];
                    resultElement.classList.add('show');
                }
            }
            
            showEnding(type) {
                console.log(`エンディング表示: ${type}`);
                this.currentScene = 'ending';
                this.showScreen('ending-screen');
                
                const endingTitle = document.getElementById('ending-title');
                const endingText = document.getElementById('ending-text');
                
                if (type === 'true') {
                    endingTitle.textContent = 'TRUE ENDING';
                    endingText.textContent = 'あなたの勝ちよ...大人になったのね。これから二人の新しい関係が始まる...';
                } else {
                    endingTitle.textContent = 'BAD ENDING';
                    endingText.textContent = 'あらあら、まだまだ子供ね♪ また今度、リベンジしてもいいわよ？';
                }
            }
        }
        
        // ゲーム開始
        window.addEventListener('DOMContentLoaded', () => {
            console.log('DOM読み込み完了');
            window.gameController = new SimpleGameController();
        });
    </script>
</body>
</html>